/*!
 * @package Content Aware Sidebars
 * @author Joachim Jensen <jv@intox.dk>
 * @license GPLv3
 * @copyright 2016 by Joachim Jensen
 */
!function(a){var b={current_section:0,sections:[],init:function(){this.upgradeNoticeHandler(),this.tabController(),this.addHandleListener(),this.reviewNoticeHandler(),this.suggestVisibility(),this.initSidebarActivation()},upgradeNoticeHandler:function(){a(".js-cas-pro-notice").on("click",function(b){b.preventDefault(),a(".js-cas-pro-read-more").attr("href",a(this).data("url")),a(".js-cas-pro-popup").trigger("click")})},initSidebarActivation:function(){Flatpickr.l10n.weekdays=CASAdmin.weekdays,Flatpickr.l10n.months=CASAdmin.months,Flatpickr.l10n.firstDayOfWeek=CASAdmin.weekStart;var b={wrap:!0,clickOpens:!0,enableTime:!0,time_24hr:!0,allowInput:!0,enableSeconds:!0,altInput:!0,altFormat:CASAdmin.dateFormat+" @ H:i:S"},c=a(".js-cas-activation"),d=a(".js-cas-expiry"),e=c.flatpickr(b),f=d.flatpickr(b);e.config.onChange=function(b,c){f.set("minDate",""!=c?new Date(b).fp_incr(1):null);var d=a(".js-cas-status");""!=c?d.prop("checked",!1):d.is(":checked")||f.clear()},f.config.onChange=function(a){e.set("maxDate",new Date(a).fp_incr(-1))},a(".js-cas-status").on("change",function(){var b=a(this),c=b.is(":checked");c?e.clear():e.selectedDates.length||f.clear()})},initTabSections:function(){a(".js-cas-tabs").find(".nav-tab").each(function(){var c=this.href.lastIndexOf("#");if(c>=0){var d=this.href.substr(c);b.sections.push(d),a(d).hide()}})},tabController:function(){this.initTabSections(),this.setCurrentSection(window.location.hash),a("#poststuff").on("click",".js-nav-link",function(){b.setCurrentSection(this.href)})},findSectionByURL:function(a){var b=this.sections.indexOf(a.substring(a.lastIndexOf("#")));return b>=0?b:null},setCurrentSection:function(b){var c=this.findSectionByURL(b)||0,d=a(".js-cas-tabs").find(".nav-tab");d.eq(c).is(":visible")&&(a(this.sections[this.current_section]).hide(),this.current_section=c,a(this.sections[this.current_section]).show(),d.removeClass("nav-tab-active"),d.eq(this.current_section).addClass("nav-tab-active"))},addHandleListener:function(){var b=a("span.host"),c=a("<div><p>Shortcode:</p><code>[ca-sidebar id="+a("#current_sidebar").val()+"]</code><p>Template Tag:</p><code>ca_display_sidebar();</code></div>"),d=a("span.merge-pos");b.after(c),a("select[name='handle']").change(function(){var e=a(this);b.attr("disabled",2==e.val()),2==e.val()?(b.hide(),c.show()):(b.show(),c.hide()),3==e.val()?d.hide():d.show()}).change()},suggestVisibility:function(){var b=a(".js-cas-visibility");b.select2({theme:"wpca",placeholder:CASAdmin.allVisibility,minimumInputLength:0,closeOnSelect:!0,allowClear:!1,nextSearchTerm:function(a,b){return b},data:CASAdmin.visibility}).on("select2:selecting",function(){b.data("forceOpen",!0)}).on("select2:close",function(a){b.data("forceOpen")&&(a.preventDefault(),b.select2("open"),b.data("forceOpen",!1))}),b.data("value")&&b.val(b.data("value").toString().split(",")).trigger("change")},reviewNoticeHandler:function(){$notice=a(".js-cas-notice-review"),$notice.on("click","a, button",function(){$this=a(this),a.ajax({url:ajaxurl,data:{action:"cas_dismiss_review_notice",dismiss:$this.attr("href")?1:0},dataType:"JSON",type:"POST",success:function(){$notice.fadeOut(400,function(){$notice.remove()})},error:function(a){}})})}};a(document).ready(function(){b.init()})}(jQuery);